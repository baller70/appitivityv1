(()=>{var e={};e.id=9881,e.ids=[9881],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:e=>{"use strict";e.exports=require("stream")},28270:(e,r,t)=>{"use strict";t.d(r,{s2:()=>d});var s=t(55511);let o=function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),(0,s.createHash)("sha1").update(e).digest()},a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,i=function(e){let r;if(!("string"==typeof e&&a.test(e)))throw TypeError("Invalid UUID");return Uint8Array.of((r=parseInt(e.slice(0,8),16))>>>24,r>>>16&255,r>>>8&255,255&r,(r=parseInt(e.slice(9,13),16))>>>8,255&r,(r=parseInt(e.slice(14,18),16))>>>8,255&r,(r=parseInt(e.slice(19,23),16))>>>8,255&r,(r=parseInt(e.slice(24,36),16))/0x10000000000&255,r/0x100000000&255,r>>>24&255,r>>>16&255,r>>>8&255,255&r)},n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));function l(e,r,t,s){var a=r,l=s;let d="string"==typeof e?function(e){let r=new Uint8Array((e=unescape(encodeURIComponent(e))).length);for(let t=0;t<e.length;++t)r[t]=e.charCodeAt(t);return r}(e):e,u="string"==typeof a?i(a):a;if("string"==typeof a&&(a=i(a)),a?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let f=new Uint8Array(16+d.length);if(f.set(u),f.set(d,u.length),(f=o(f))[6]=15&f[6]|80,f[8]=63&f[8]|128,t){l=l||0;for(let e=0;e<16;++e)t[l+e]=f[e];return t}return function(e,r=0){return(n[e[r+0]]+n[e[r+1]]+n[e[r+2]]+n[e[r+3]]+"-"+n[e[r+4]]+n[e[r+5]]+"-"+n[e[r+6]]+n[e[r+7]]+"-"+n[e[r+8]]+n[e[r+9]]+"-"+n[e[r+10]]+n[e[r+11]]+n[e[r+12]]+n[e[r+13]]+n[e[r+14]]+n[e[r+15]]).toLowerCase()}(f)}function d(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)?e:l(e,"6ba7b810-9dad-11d1-80b4-00c04fd430c8")}l.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",l.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8"},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45070:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>b,routeModule:()=>h,serverHooks:()=>w,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{GET:()=>c,POST:()=>p});var o=t(96559),a=t(48088),i=t(37719),n=t(32190),l=t(60166),d=t(56621),u=t(28270);class f{constructor(e){if(this.userId=(0,u.s2)(e),!d.E2)throw Error("Supabase admin client is not available");this.supabase=d.E2}async getFolders(){let{data:e,error:r}=await this.supabase.from("folders").select("*").eq("user_id",this.userId).order("name");if(r)throw Error(`Failed to fetch folders: ${r.message}`);return e||[]}async getFolderTree(){let e=await this.getFolders();return this.buildFolderTree(e)}async getFoldersWithCounts(){let{data:e,error:r}=await this.supabase.from("folders").select(`
        *,
        bookmarks(count)
      `).eq("user_id",this.userId).order("name");if(r)throw Error(`Failed to fetch folders with counts: ${r.message}`);return e?.map(e=>({...e,bookmarkCount:e.bookmarks?.[0]?.count||0}))||[]}async getFolder(e){let{data:r,error:t}=await this.supabase.from("folders").select("*").eq("id",e).eq("user_id",this.userId).single();if(t){if("PGRST116"===t.code)return null;throw Error(`Failed to fetch folder: ${t.message}`)}return r}async createFolder(e){let r={...e,user_id:this.userId};console.log("FolderService.createFolder called with:",{originalData:e,finalData:r,userId:this.userId,supabaseClientType:"admin"});let{data:t,error:s}=await this.supabase.from("folders").insert(r).select().single();if(console.log("FolderService.createFolder result:",{data:t,error:s}),s)throw console.error("FolderService.createFolder error details:",{code:s.code,message:s.message,details:s.details,hint:s.hint}),Error(`Failed to create folder: ${s.message}`);return t}async updateFolder(e,r){let{data:t,error:s}=await this.supabase.from("folders").update(r).eq("id",e).eq("user_id",this.userId).select().single();if(s)throw Error(`Failed to update folder: ${s.message}`);return t}async deleteFolder(e){let[r,t]=await Promise.all([this.supabase.from("folders").select("id").eq("parent_id",e).eq("user_id",this.userId),this.supabase.from("bookmarks").select("id").eq("folder_id",e).eq("user_id",this.userId)]);if(r.data&&r.data.length>0)throw Error("Cannot delete folder with subfolders. Move or delete subfolders first.");if(t.data&&t.data.length>0)throw Error("Cannot delete folder with bookmarks. Move or delete bookmarks first.");let{error:s}=await this.supabase.from("folders").delete().eq("id",e).eq("user_id",this.userId);if(s)throw Error(`Failed to delete folder: ${s.message}`)}async getRootFolders(){let{data:e,error:r}=await this.supabase.from("folders").select("*").eq("user_id",this.userId).is("parent_id",null).order("name");if(r)throw Error(`Failed to fetch root folders: ${r.message}`);return e||[]}async getSubfolders(e){let{data:r,error:t}=await this.supabase.from("folders").select("*").eq("user_id",this.userId).eq("parent_id",e).order("name");if(t)throw Error(`Failed to fetch subfolders: ${t.message}`);return r||[]}async moveFolder(e,r){if(r&&await this.wouldCreateCircularReference(e,r))throw Error("Cannot move folder: would create circular reference");return this.updateFolder(e,{parent_id:r})}async wouldCreateCircularReference(e,r){let t=r;for(;t;){if(t===e)return!0;let r=await this.getFolder(t);t=r?.parent_id||null}return!1}buildFolderTree(e){let r=new Map,t=[];return e.forEach(e=>{r.set(e.id,{...e,children:[]})}),e.forEach(e=>{let s=r.get(e.id);if(e.parent_id){let t=r.get(e.parent_id);t&&(t.children=t.children||[],t.children.push(s))}else t.push(s)}),t}async getFolderPath(e){let r=[],t=e;for(;t;){let e=await this.getFolder(t);if(!e)break;r.unshift(e),t=e.parent_id}return r}async searchFolders(e){let{data:r,error:t}=await this.supabase.from("folders").select("*").eq("user_id",this.userId).ilike("name",`%${e}%`).order("name");if(t)throw Error(`Failed to search folders: ${t.message}`);return r||[]}}async function c(){try{let{userId:e}=await (0,l.j)(),r=e||"demo-user";if(!r)return n.NextResponse.json({error:"No user session"},{status:401});let t=new f(r),s=await t.getFolders();return n.NextResponse.json(s)}catch(e){return console.error("Error fetching folders:",e),n.NextResponse.json({error:"Failed to fetch folders"},{status:500})}}async function p(e){try{let{userId:r}=await (0,l.j)(),t=r||"demo-user";if(!t)return n.NextResponse.json({error:"No user session"},{status:401});let s=await e.json(),o=new f(t),a=await o.createFolder(s);return n.NextResponse.json(a)}catch(e){return console.error("Error creating folder:",e),n.NextResponse.json({error:"Failed to create folder"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/folders/route",pathname:"/api/folders",filename:"route",bundlePath:"app/api/folders/route"},resolvedPagePath:"/Volumes/Softwaare Program/apptivity final v1/src/app/api/folders/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:g,serverHooks:w}=h;function b(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:g})}},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56621:(e,r,t)=>{"use strict";let s;t.d(r,{E2:()=>l,ND:()=>n,Sw:()=>d});var o=t(78521);let a="https://bpmixidxyljfvenukcun.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJwbWl4aWR4eWxqZnZlbnVrY3VuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4ODAwMjIsImV4cCI6MjA2NDQ1NjAyMn0.JmyZhvuPfJlzQ9PPEclEc7mKBd55zCEM61nci7fjazc",n=(0,o.UU)(a,i,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}});(s=process.env.SUPABASE_SERVICE_ROLE_KEY)||console.warn("WARNING: SUPABASE_SERVICE_ROLE_KEY not found on server. Some operations may fail.");let l=s?(0,o.UU)(a,s,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}):null;function d(e){return(0,o.UU)(a,i,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1},global:{headers:{"x-user-id":e}}})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},74075:e=>{"use strict";e.exports=require("zlib")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[80,166,5575],()=>t(45070));module.exports=s})();