(()=>{var e={};e.id=7885,e.ids=[7885],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4826:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>w,routeModule:()=>g,serverHooks:()=>x,workAsyncStorage:()=>b,workUnitAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{DELETE:()=>p,GET:()=>c,POST:()=>f,PUT:()=>m});var o=t(96559),a=t(48088),i=t(37719),n=t(32190),u=t(60166),l=t(56621),d=t(28270);class k{constructor(e){this.originalUserId=e,this.userId=(0,d.s2)(e),l.E2?this.supabase=l.E2:this.supabase=(0,l.Sw)(this.userId),console.log("BookmarkService initialized for user:",{original:this.originalUserId,normalized:this.userId,environment:"server"})}async getBookmarks(e){console.log("Fetching bookmarks for user:",this.userId);let r=this.supabase.from("bookmarks").select(`
        *,
        folder:folders(*),
        tags:bookmark_tags(tag:tags(*))
      `).eq("user_id",this.userId).order("created_at",{ascending:!1});e?.folderId&&(r=r.eq("folder_id",e.folderId)),e?.isArchived!==void 0&&(r=r.eq("is_archived",e.isArchived)),e?.isFavorite!==void 0&&(r=r.eq("is_favorite",e.isFavorite)),e?.limit&&(r=r.limit(e.limit)),e?.offset&&(r=r.range(e.offset,e.offset+(e.limit||10)-1));let{data:t,error:s}=await r;if(s)throw console.error("Error fetching bookmarks:",s),Error(`Failed to fetch bookmarks: ${s.message}`);return console.log(`Found ${t?.length||0} bookmarks for user`),t?.map(e=>({...e,tags:e.tags?.map(e=>e.tag).filter(Boolean)||[]}))||[]}async getBookmark(e){console.log("Fetching bookmark:",e,"for user:",this.userId);let{data:r,error:t}=await this.supabase.from("bookmarks").select(`
        *,
        folder:folders(*),
        tags:bookmark_tags(tag:tags(*))
      `).eq("id",e).eq("user_id",this.userId).single();if(t){if("PGRST116"===t.code)return console.log("Bookmark not found:",e),null;throw console.error("Error fetching bookmark:",t),Error(`Failed to fetch bookmark: ${t.message}`)}return console.log("Successfully fetched bookmark:",e),{...r,tags:r.tags?.map(e=>e.tag).filter(Boolean)||[]}}async createBookmark(e,r){console.log("Creating bookmark for user:",this.userId);let t={...e,user_id:this.userId,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:s,error:o}=await this.supabase.from("bookmarks").insert(t).select().single();if(o)throw console.error("Error creating bookmark:",o),Error(`Failed to create bookmark: ${o.message}`);return console.log("Successfully created bookmark:",s.id),r&&r.length>0&&await this.addTagsToBookmark(s.id,r),s}async updateBookmark(e,r){console.log("Updating bookmark:",e,"for user:",this.userId);let t={...r,updated_at:new Date().toISOString()},{data:s,error:o}=await this.supabase.from("bookmarks").update(t).eq("id",e).eq("user_id",this.userId).select().single();if(o)throw console.error("Error updating bookmark:",o),Error(`Failed to update bookmark: ${o.message}`);return console.log("Successfully updated bookmark:",e),s}async deleteBookmark(e){console.log("Deleting bookmark:",e,"for user:",this.userId);let{error:r}=await this.supabase.from("bookmarks").delete().eq("id",e).eq("user_id",this.userId);if(r)throw console.error("Error deleting bookmark:",r),Error(`Failed to delete bookmark: ${r.message}`);console.log("Successfully deleted bookmark:",e)}async addTagsToBookmark(e,r){let t=r.map(r=>({bookmark_id:e,tag_id:r})),{error:s}=await this.supabase.from("bookmark_tags").insert(t);if(s)throw Error(`Failed to add tags to bookmark: ${s.message}`)}async removeTagsFromBookmark(e,r){let t=this.supabase.from("bookmark_tags").delete().eq("bookmark_id",e);r&&(t=t.in("tag_id",r));let{error:s}=await t;if(s)throw Error(`Failed to remove tags from bookmark: ${s.message}`)}async searchBookmarks(e){let{data:r,error:t}=await this.supabase.from("bookmarks").select(`
        *,
        folder:folders(*),
        tags:bookmark_tags(tag:tags(*))
      `).eq("user_id",this.userId).or(`title.ilike.%${e}%,description.ilike.%${e}%,url.ilike.%${e}%`).order("created_at",{ascending:!1});if(t)throw Error(`Failed to search bookmarks: ${t.message}`);return r?.map(e=>({...e,tags:e.tags?.map(e=>e.tag).filter(Boolean)||[]}))||[]}async toggleFavorite(e){let r=await this.getBookmark(e);if(!r)throw Error("Bookmark not found");return this.updateBookmark(e,{is_favorite:!r.is_favorite})}async toggleArchive(e){let r=await this.getBookmark(e);if(!r)throw Error("Bookmark not found");return this.updateBookmark(e,{is_archived:!r.is_archived})}async bulkUpdate(e,r){let{error:t}=await this.supabase.from("bookmarks").update(r).in("id",e).eq("user_id",this.userId);if(t)throw Error(`Failed to bulk update bookmarks: ${t.message}`)}async bulkDelete(e){let{error:r}=await this.supabase.from("bookmarks").delete().in("id",e).eq("user_id",this.userId);if(r)throw Error(`Failed to bulk delete bookmarks: ${r.message}`)}}async function c(){try{let{userId:e}=await (0,u.j)(),r=e||"demo-user";if(!r)return n.NextResponse.json({error:"No user session"},{status:401});let t=new k(r),s=await t.getBookmarks();return n.NextResponse.json(s)}catch(e){return console.error("Error fetching bookmarks:",e),n.NextResponse.json({error:"Failed to fetch bookmarks"},{status:500})}}async function f(e){try{let{userId:r}=await (0,u.j)(),t=r||"demo-user";if(!t)return n.NextResponse.json({error:"No user session"},{status:401});let s=await e.json(),o=(0,d.s2)(t),{tagIds:a,...i}=s;if(!l.E2)return n.NextResponse.json({error:"Database connection not available"},{status:500});let{data:k,error:c}=await l.E2.from("bookmarks").insert({...i,user_id:o}).select().single();if(c)return console.error("Database error:",c),n.NextResponse.json({error:`Failed to create bookmark: ${c.message}`},{status:500});if(a&&a.length>0){let e=a.map(e=>({bookmark_id:k.id,tag_id:e})),{error:r}=await l.E2.from("bookmark_tags").insert(e);r&&console.error("Tag error:",r)}return n.NextResponse.json(k)}catch(e){return console.error("Error creating bookmark:",e),n.NextResponse.json({error:"Failed to create bookmark"},{status:500})}}async function m(e){try{let{userId:r}=await (0,u.j)(),t=r||"demo-user";if(!t)return n.NextResponse.json({error:"No user session"},{status:401});let{id:s,...o}=await e.json();if(!s)return n.NextResponse.json({error:"Bookmark ID is required"},{status:400});let a=(0,d.s2)(t);if(!l.E2)return n.NextResponse.json({error:"Database connection not available"},{status:500});let{data:i,error:k}=await l.E2.from("bookmarks").update(o).eq("id",s).eq("user_id",a).select().single();if(k)return console.error("Database error:",k),n.NextResponse.json({error:`Failed to update bookmark: ${k.message}`},{status:500});if(!i)return n.NextResponse.json({error:"Bookmark not found"},{status:404});return n.NextResponse.json(i)}catch(e){return console.error("Error updating bookmark:",e),n.NextResponse.json({error:"Failed to update bookmark"},{status:500})}}async function p(e){try{let{userId:r}=await (0,u.j)(),t=r||"demo-user";if(!t)return n.NextResponse.json({error:"No user session"},{status:401});let s=new URL(e.url),o=s.searchParams.get("id"),a=s.searchParams.get("ids");if(!o&&!a)return n.NextResponse.json({error:"Bookmark ID or IDs are required"},{status:400});let i=(0,d.s2)(t);if(!l.E2)return n.NextResponse.json({error:"Database connection not available"},{status:500});if(a){let e=a.split(",");await l.E2.from("bookmark_tags").delete().in("bookmark_id",e);let{error:r}=await l.E2.from("bookmarks").delete().in("id",e).eq("user_id",i);if(r)return console.error("Database error:",r),n.NextResponse.json({error:`Failed to delete bookmarks: ${r.message}`},{status:500});return n.NextResponse.json({message:`Successfully deleted ${e.length} bookmarks`})}{await l.E2.from("bookmark_tags").delete().eq("bookmark_id",o);let{error:e}=await l.E2.from("bookmarks").delete().eq("id",o).eq("user_id",i);if(e)return console.error("Database error:",e),n.NextResponse.json({error:`Failed to delete bookmark: ${e.message}`},{status:500});return n.NextResponse.json({message:"Bookmark deleted successfully"})}}catch(e){return console.error("Error deleting bookmark(s):",e),n.NextResponse.json({error:"Failed to delete bookmark(s)"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/bookmarks/route",pathname:"/api/bookmarks",filename:"route",bundlePath:"app/api/bookmarks/route"},resolvedPagePath:"/Volumes/Softwaare Program/apptivity final v1/src/app/api/bookmarks/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:b,workUnitAsyncStorage:h,serverHooks:x}=g;function w(){return(0,i.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:h})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:e=>{"use strict";e.exports=require("stream")},28270:(e,r,t)=>{"use strict";t.d(r,{s2:()=>l});var s=t(55511);let o=function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),(0,s.createHash)("sha1").update(e).digest()},a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,i=function(e){let r;if(!("string"==typeof e&&a.test(e)))throw TypeError("Invalid UUID");return Uint8Array.of((r=parseInt(e.slice(0,8),16))>>>24,r>>>16&255,r>>>8&255,255&r,(r=parseInt(e.slice(9,13),16))>>>8,255&r,(r=parseInt(e.slice(14,18),16))>>>8,255&r,(r=parseInt(e.slice(19,23),16))>>>8,255&r,(r=parseInt(e.slice(24,36),16))/0x10000000000&255,r/0x100000000&255,r>>>24&255,r>>>16&255,r>>>8&255,255&r)},n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));function u(e,r,t,s){var a=r,u=s;let l="string"==typeof e?function(e){let r=new Uint8Array((e=unescape(encodeURIComponent(e))).length);for(let t=0;t<e.length;++t)r[t]=e.charCodeAt(t);return r}(e):e,d="string"==typeof a?i(a):a;if("string"==typeof a&&(a=i(a)),a?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let k=new Uint8Array(16+l.length);if(k.set(d),k.set(l,d.length),(k=o(k))[6]=15&k[6]|80,k[8]=63&k[8]|128,t){u=u||0;for(let e=0;e<16;++e)t[u+e]=k[e];return t}return function(e,r=0){return(n[e[r+0]]+n[e[r+1]]+n[e[r+2]]+n[e[r+3]]+"-"+n[e[r+4]]+n[e[r+5]]+"-"+n[e[r+6]]+n[e[r+7]]+"-"+n[e[r+8]]+n[e[r+9]]+"-"+n[e[r+10]]+n[e[r+11]]+n[e[r+12]]+n[e[r+13]]+n[e[r+14]]+n[e[r+15]]).toLowerCase()}(k)}function l(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)?e:u(e,"6ba7b810-9dad-11d1-80b4-00c04fd430c8")}u.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",u.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8"},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56621:(e,r,t)=>{"use strict";let s;t.d(r,{E2:()=>u,ND:()=>n,Sw:()=>l});var o=t(78521);let a="https://bpmixidxyljfvenukcun.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJwbWl4aWR4eWxqZnZlbnVrY3VuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4ODAwMjIsImV4cCI6MjA2NDQ1NjAyMn0.JmyZhvuPfJlzQ9PPEclEc7mKBd55zCEM61nci7fjazc",n=(0,o.UU)(a,i,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}});(s=process.env.SUPABASE_SERVICE_ROLE_KEY)||console.warn("WARNING: SUPABASE_SERVICE_ROLE_KEY not found on server. Some operations may fail.");let u=s?(0,o.UU)(a,s,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}):null;function l(e){return(0,o.UU)(a,i,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1},global:{headers:{"x-user-id":e}}})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},74075:e=>{"use strict";e.exports=require("zlib")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[80,166,5575],()=>t(4826));module.exports=s})();